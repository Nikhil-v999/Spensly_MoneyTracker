{% include "header.html" %}

{% block title %}Dashboard{% endblock %}
{% from "bootstrap5/form.html" import render_form %}
{% block content %}
<br>
<br>
<br>
<br>
<br>
<br>
  <div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <!-- Welcome Message -->
            <h1>Welcome back,{{current_user.name}}!</h1>
            <p class="lead">Here's your financial summary.</p>
        </div>
    </div>

    <!-- Summary Bar -->
    <div class="row g-4 mb-5">

  <!-- Total Spent -->
  <div class="col-md-4">
    <div class="insight-tile">
      <div class="insight-icon spent">
        <i class="fas fa-wallet"></i>
      </div>
      <div class="insight-content">
        <p class="insight-label">Total Spent This Month</p>
        <h3 class="insight-value">₹{{ total_this_month }}</h3>
      </div>
    </div>
  </div>

  <!-- Top Category -->
  <div class="col-md-4">
    <div class="insight-tile">
      <div class="insight-icon category">
        <i class="fas fa-utensils"></i>
      </div>
      <div class="insight-content">
        <p class="insight-label">Top Category</p>
        <h3 class="insight-value">
          {{ top_category }}<br>
          <span class="sub-value">₹{{ top_category_amount }}</span>
        </h3>
      </div>
    </div>
  </div>

  <!-- Transactions -->
  <div class="col-md-4">
    <div class="insight-tile">
      <div class="insight-icon count">
        <i class="fas fa-list"></i>
      </div>
      <div class="insight-content">
        <p class="insight-label">Transactions</p>
        <h3 class="insight-value">{{ total_transactions }}</h3>
      </div>
    </div>
  </div>

</div>



    <div class="row justify-content-center g-4">

  <div class="col-lg-4">
    <div class="action-tile" data-bs-toggle="modal" href="#portfolioModal1">
      <div class="action-icon add">
        <i class="fas fa-plus"></i>
      </div>
      <div class="action-content">
        <h5>Add Expense</h5>
        <p>Log a new transaction</p>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <a class="action-tile" href="{{url_for('view_trans')}}">
      <div class="action-icon view">
        <i class="fas fa-list"></i>
      </div>
      <div class="action-content">
        <h5>View All Transactions</h5>
        <p>See your spending history</p>
      </div>
    </a>
  </div>

  <div class="col-lg-4">
    <div class="action-tile">
      <div class="action-icon analyze">
        <i class="fas fa-chart-pie"></i>
      </div>
      <div class="action-content">
        <h5>Analysis</h5>
        <p>Understand your spending</p>
      </div>
    </div>
  </div>

</div>
<div class="mb-4"></div>

<!--<div class="row justify-content-center text-center g-4">-->

<!--  &lt;!&ndash; Item 1 &ndash;&gt;-->
<!--  <div class="col-lg-4 col-md-6">-->
<!--    <a class="action-card" data-bs-toggle="modal" href="#portfolioModal1">-->
<!--      <img src="./static/assets/img/portfolio/10.jpg" alt="Add Expense">-->
<!--      <p class="action-text">Add Expense</p>-->
<!--    </a>-->
<!--  </div>-->

<!--  &lt;!&ndash; Item 2 &ndash;&gt;-->
<!--  <div class="col-lg-4 col-md-6">-->
<!--    <a class="action-card" data-bs-toggle="modal" href="#portfolioModal2">-->
<!--      <img src="./static/assets/img/portfolio/10.jpg" alt="View Transactions">-->
<!--      <p class="action-text">View All Transactions</p>-->
<!--    </a>-->
<!--  </div>-->

<!--  &lt;!&ndash; Item 3 &ndash;&gt;-->
<!--  <div class="col-lg-4 col-md-6">-->
<!--    <a class="action-card" href="#">-->
<!--      <img src="./static/assets/img/portfolio/10.jpg" alt="Analysis">-->
<!--      <p class="action-text">Analysis</p>-->
<!--    </a>-->
<!--  </div>-->

<!--</div>-->













{% with messages = get_flashed_messages() %}
      {% if messages %}
      {% for message in messages %}
      <p class="flash">{{ message }}</p>
      {% endfor %}
      {% endif %}
      {% endwith %}
    <!-- Quick Add Form & Recent Transactions Row -->
    <div class="row">
        <!-- Quick Add Form Column -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5>Add New Expense</h5>
                </div>
                <div class="card-body">
                <!--form is there for details -->
                     {{render_form(form, novalidate=True, button_map={"submit": "primary"}) }}

                </div>
            </div>
        </div>

        <!-- Recent Transactions Column -->
        <div class="col-lg-8">
    <div class="card">
        <div class="card-header">
            <h5>Recent Transactions</h5>
        </div>
        <div class="card-body">
            {% if expenses %}
                <table class="table table-striped transactions-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th class="text-end">Amount</th>
                            <th>Delete</th>
                            <th>Edit</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for expense in expenses %}
                        <tr>
                            <td>{{ expense.date.strftime("%d-%m-%Y") }}</td>
                            <td>{{ expense.category }}</td>
                            <td>{{ expense.description or "-" }}</td>
                            <td class="text-end">₹{{ "%.2f"|format(expense.amount) }}</td>
                            <td><a href="{{ url_for('delete_expense', expense_id=expense.id) }}" onclick="return confirm('Are you sure you want to delete this expense?');">Delete</a>
</td>
                            <td><a href="{{ url_for('edit_expense', expense_id=expense.id) }}">Edit</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No transactions yet. Add your first expense!</p>
            {% endif %}
        </div>
    </div>
</div>

    </div>
</div>






<!-- Portfolio item 1 modal popup-->
        <div class="portfolio-modal modal fade" id="portfolioModal1" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="close-modal" data-bs-dismiss="modal"><img src="./static/assets/img/close-icon.svg" alt="Close modal" /></div>
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-8">
                                <div class="modal-body">
                                    <!-- Project details-->
<!--                                    <h2 class="text-uppercase">Project Name</h2>-->
<!--                                    <p class="item-intro text-muted">Lorem ipsum dolor sit amet consectetur.</p>-->
<!--                                    <img class="img-fluid d-block mx-auto" src="./static/assets/img/portfolio/1.jpg" alt="..." />-->
<!--                                    <p>Use this area to describe your project. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Est blanditiis dolorem culpa incidunt minus dignissimos deserunt repellat aperiam quasi sunt officia expedita beatae cupiditate, maiores repudiandae, nostrum, reiciendis facere nemo!</p>-->
<!--                                    <ul class="list-inline">-->
<!--                                        <li>-->
<!--                                            <strong>Client:</strong>-->
<!--                                            Threads-->
<!--                                        </li>-->
<!--                                        <li>-->
<!--                                            <strong>Category:</strong>-->
<!--                                            Illustration-->
<!--                                        </li>-->
<!--                                    </ul>-->
<!--                                    <button class="btn btn-primary btn-xl text-uppercase" data-bs-dismiss="modal" type="button">-->
<!--                                        <i class="fas fa-xmark me-1"></i>-->
<!--                                        Close Project-->
<!--                                    </button>-->
                                    <div class="col-lg ">
            <div class="card">
                <div class="card-header">
                    <h5>Add New Expense</h5>
                </div>
                <div class="card-body">
                <!--form is there for details -->
                     {{render_form(form, novalidate=True, button_map={"submit": "primary"}) }}

                </div>
            </div>
        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>





<!-- Portfolio item 2 modal popup-->
        <div class="portfolio-modal modal fade" id="portfolioModal2" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="close-modal" data-bs-dismiss="modal"><img src="./static/assets/img/close-icon.svg" alt="Close modal" /></div>
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-8">
                                <div class="modal-body">
                                        <form method="GET" class="row g-3 mb-3">

                                          <div class="col-md-3">
                                              <h5><u>Categories</u></h5>
                                            <select name="category" class="form-select">
                                              <option value="">All Categories</option>
                                              <option value="Food & Dining">Food & Dining</option>
                                              <option value="Transportation">Transportation</option>
                                              <option value="Entertainment">Entertainment</option>
                                                <option value="Personal Care">Personal Care</option>
                                                <option value="Clothing">Clothing</option>
                                                <option value="Other">Other</option>
                                            </select>
                                          </div>

                                          <div class="col-md-3">
                                              <h5><u>Start Date</u></h5>
                                            <input type="date" name="start_date" class="form-control">
                                          </div>

                                          <div class="col-md-3">
                                              <h5><u>End Date</u></h5>
                                            <input type="date" name="end_date" class="form-control">
                                          </div>

                                          <div class="col-md-3">
                                              <h5><u>Sort By:</u></h5>
                                            <select name="sort" class="form-select">
                                              <option value="date_desc">Newest First</option>
                                              <option value="date_asc">Oldest First</option>
                                              <option value="amount_desc">Amount: High → Low</option>
                                              <option value="amount_asc">Amount: Low → High</option>
                                            </select>
                                          </div>

                                          <div class="col-12 text-end">
                                            <button class="btn btn-dark btn-sm">Apply</button>
                                          </div>

                                        </form>

                                    <!-- Project details-->
<!--                                    <h2 class="text-uppercase">Project Name</h2>-->
<!--                                    <p class="item-intro text-muted">Lorem ipsum dolor sit amet consectetur.</p>-->
<!--                                    <img class="img-fluid d-block mx-auto" src="./static/assets/img/portfolio/1.jpg" alt="..." />-->
<!--                                    <p>Use this area to describe your project. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Est blanditiis dolorem culpa incidunt minus dignissimos deserunt repellat aperiam quasi sunt officia expedita beatae cupiditate, maiores repudiandae, nostrum, reiciendis facere nemo!</p>-->
<!--                                    <ul class="list-inline">-->
<!--                                        <li>-->
<!--                                            <strong>Client:</strong>-->
<!--                                            Threads-->
<!--                                        </li>-->
<!--                                        <li>-->
<!--                                            <strong>Category:</strong>-->
<!--                                            Illustration-->
<!--                                        </li>-->
<!--                                    </ul>-->
<!--                                    <button class="btn btn-primary btn-xl text-uppercase" data-bs-dismiss="modal" type="button">-->
<!--                                        <i class="fas fa-xmark me-1"></i>-->
<!--                                        Close Project-->
<!--                                    </button>-->
                                    <div class="col-lg">
    <div class="card">
        <div class="card-header">
            <h5>Recent Transactions</h5>
        </div>
        <div class="card-body">
            {% if all_expenses %}
                <table class="table table-striped transactions-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th class="text-end">Amount</th>
                            <th>Delete</th>
                            <th>Edit</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for all_expense in all_expenses %}
                        <tr>
                            <td>{{ all_expense.date.strftime("%d-%m-%Y") }}</td>
                            <td>{{ all_expense.category }}</td>
                            <td>{{ all_expense.description or "-" }}</td>
                            <td class="text-end">₹{{ "%.2f"|format(all_expense.amount) }}</td>
                            <td><a href="{{ url_for('delete_expense', expense_id=all_expense.id) }}" onclick="return confirm('Are you sure you want to delete this expense?');">Delete</a>
</td>
                            <td><a href="{{ url_for('edit_expense', expense_id=all_expense.id) }}">Edit</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No transactions yet. Add your first expense!</p>
            {% endif %}
        </div>
    </div>
</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}

{% include "footer.html" %}