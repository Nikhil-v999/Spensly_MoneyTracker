{% include "header.html" %}

{% block title %}Dashboard{% endblock %}
{% from "bootstrap5/form.html" import render_form %}
{% block content %}
<br>
<br>
<br>
<br>
<br>
<br>
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <!-- Welcome Message -->
            <h1>Welcome back,{{current_user.name}}!</h1>
            <p class="lead">Here's your financial summary.</p>
        </div>
    </div>

    <!-- Summary Bar -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total Spent This Month</h5>
                    <p class="card-text display-6">{{total_this_month}}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Top Category-Amount</h5>
                    <p class="card-text display-6">{{top_category}}-₹{{top_category_amount}}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Transactions</h5>
                    <p class="card-text display-6">{{total_transactions}}</p>
                </div>
            </div>
        </div>
    </div>



    <section class="page-section " id="portfolio">
            <div class="container">

                <div class="row">
                    <div class="col-lg-4 col-sm-6 mb-4">
                        <!-- Portfolio item 1-->
                            <div class="portfolio-item">
                                <a class="portfolio-link" data-bs-toggle="modal" href="#portfolioModal1">
                                <div class="portfolio-hover">
                                    <div class="portfolio-hover-content"><i class="fas fa-plus fa-3x"></i></div>
                                </div>
                                <img class="img-fluid" src="./static/assets/img/portfolio/10.jpg" alt="..." />
                            </a>
<!--                            <div class="portfolio-caption">-->
<!--                                <div class="portfolio-caption-heading">Threads</div>-->
<!--                                <div class="portfolio-caption-subheading text-muted">Illustration</div>-->
<!--                            </div>-->
                        </div>
                    </div>

                    <div class="col-lg-4 col-sm-6 mb-4">
                        <!-- Portfolio item 2-->
                            <div class="portfolio-item">
                                <a class="portfolio-link" data-bs-toggle="modal" href="#portfolioModal2">
                                <div class="portfolio-hover">
                                    <div class="portfolio-hover-content"><i class="fas fa-history fa-3x"></i>
</div>
                                </div>
                                <img class="img-fluid" src="./static/assets/img/portfolio/10.jpg" alt="..." />
                            </a>
<!--                            <div class="portfolio-caption">-->
<!--                                <div class="portfolio-caption-heading">Threads</div>-->
<!--                                <div class="portfolio-caption-subheading text-muted">Illustration</div>-->
<!--                            </div>-->
                        </div>
                    </div>


                </div>
            </div>
    </section>

{% with messages = get_flashed_messages() %}
      {% if messages %}
      {% for message in messages %}
      <p class="flash">{{ message }}</p>
      {% endfor %}
      {% endif %}
      {% endwith %}
    <!-- Quick Add Form & Recent Transactions Row -->
    <div class="row">
        <!-- Quick Add Form Column -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5>Add New Expense</h5>
                </div>
                <div class="card-body">
                <!--form is there for details -->
                     {{render_form(form, novalidate=True, button_map={"submit": "primary"}) }}

                </div>
            </div>
        </div>

        <!-- Recent Transactions Column -->
        <div class="col-lg-8">
    <div class="card">
        <div class="card-header">
            <h5>Recent Transactions</h5>
        </div>
        <div class="card-body">
            {% if expenses %}
                <table class="table table-striped transactions-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th class="text-end">Amount</th>
                            <th>Delete</th>
                            <th>Edit</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for expense in expenses %}
                        <tr>
                            <td>{{ expense.date.strftime("%d-%m-%Y") }}</td>
                            <td>{{ expense.category }}</td>
                            <td>{{ expense.description or "-" }}</td>
                            <td class="text-end">₹{{ "%.2f"|format(expense.amount) }}</td>
                            <td><a href="{{ url_for('delete_expense', expense_id=expense.id) }}" onclick="return confirm('Are you sure you want to delete this expense?');">Delete</a>
</td>
                            <td><a href="{{ url_for('edit_expense', expense_id=expense.id) }}">Edit</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No transactions yet. Add your first expense!</p>
            {% endif %}
        </div>
    </div>
</div>

    </div>
</div>






<!-- Portfolio item 1 modal popup-->
        <div class="portfolio-modal modal fade" id="portfolioModal1" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="close-modal" data-bs-dismiss="modal"><img src="./static/assets/img/close-icon.svg" alt="Close modal" /></div>
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-8">
                                <div class="modal-body">
                                    <!-- Project details-->
<!--                                    <h2 class="text-uppercase">Project Name</h2>-->
<!--                                    <p class="item-intro text-muted">Lorem ipsum dolor sit amet consectetur.</p>-->
<!--                                    <img class="img-fluid d-block mx-auto" src="./static/assets/img/portfolio/1.jpg" alt="..." />-->
<!--                                    <p>Use this area to describe your project. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Est blanditiis dolorem culpa incidunt minus dignissimos deserunt repellat aperiam quasi sunt officia expedita beatae cupiditate, maiores repudiandae, nostrum, reiciendis facere nemo!</p>-->
<!--                                    <ul class="list-inline">-->
<!--                                        <li>-->
<!--                                            <strong>Client:</strong>-->
<!--                                            Threads-->
<!--                                        </li>-->
<!--                                        <li>-->
<!--                                            <strong>Category:</strong>-->
<!--                                            Illustration-->
<!--                                        </li>-->
<!--                                    </ul>-->
<!--                                    <button class="btn btn-primary btn-xl text-uppercase" data-bs-dismiss="modal" type="button">-->
<!--                                        <i class="fas fa-xmark me-1"></i>-->
<!--                                        Close Project-->
<!--                                    </button>-->
                                    <div class="col-lg ">
            <div class="card">
                <div class="card-header">
                    <h5>Add New Expense</h5>
                </div>
                <div class="card-body">
                <!--form is there for details -->
                     {{render_form(form, novalidate=True, button_map={"submit": "primary"}) }}

                </div>
            </div>
        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>





<!-- Portfolio item 2 modal popup-->
        <div class="portfolio-modal modal fade" id="portfolioModal2" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="close-modal" data-bs-dismiss="modal"><img src="./static/assets/img/close-icon.svg" alt="Close modal" /></div>
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-8">
                                <div class="modal-body">
                                    <!-- Project details-->
<!--                                    <h2 class="text-uppercase">Project Name</h2>-->
<!--                                    <p class="item-intro text-muted">Lorem ipsum dolor sit amet consectetur.</p>-->
<!--                                    <img class="img-fluid d-block mx-auto" src="./static/assets/img/portfolio/1.jpg" alt="..." />-->
<!--                                    <p>Use this area to describe your project. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Est blanditiis dolorem culpa incidunt minus dignissimos deserunt repellat aperiam quasi sunt officia expedita beatae cupiditate, maiores repudiandae, nostrum, reiciendis facere nemo!</p>-->
<!--                                    <ul class="list-inline">-->
<!--                                        <li>-->
<!--                                            <strong>Client:</strong>-->
<!--                                            Threads-->
<!--                                        </li>-->
<!--                                        <li>-->
<!--                                            <strong>Category:</strong>-->
<!--                                            Illustration-->
<!--                                        </li>-->
<!--                                    </ul>-->
<!--                                    <button class="btn btn-primary btn-xl text-uppercase" data-bs-dismiss="modal" type="button">-->
<!--                                        <i class="fas fa-xmark me-1"></i>-->
<!--                                        Close Project-->
<!--                                    </button>-->
                                    <div class="col-lg">
    <div class="card">
        <div class="card-header">
            <h5>Recent Transactions</h5>
        </div>
        <div class="card-body">
            {% if all_expenses %}
                <table class="table table-striped transactions-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th class="text-end">Amount</th>
                            <th>Delete</th>
                            <th>Edit</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for all_expense in all_expenses %}
                        <tr>
                            <td>{{ all_expense.date.strftime("%d-%m-%Y") }}</td>
                            <td>{{ all_expense.category }}</td>
                            <td>{{ all_expense.description or "-" }}</td>
                            <td class="text-end">₹{{ "%.2f"|format(all_expense.amount) }}</td>
                            <td><a href="{{ url_for('delete_expense', expense_id=all_expense.id) }}" onclick="return confirm('Are you sure you want to delete this expense?');">Delete</a>
</td>
                            <td><a href="{{ url_for('edit_expense', expense_id=all_expense.id) }}">Edit</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No transactions yet. Add your first expense!</p>
            {% endif %}
        </div>
    </div>
</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}

{% include "footer.html" %}