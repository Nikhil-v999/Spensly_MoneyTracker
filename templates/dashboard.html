{% include "header.html" %}

{% block title %}Dashboard{% endblock %}
{% from "bootstrap5/form.html" import render_form %}
{% block content %}
<br>
<br>
<br>
<br>
<br>
<br>
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <!-- Welcome Message -->
            <h1>Welcome back,{{current_user.name}}!</h1>
            <p class="lead">Here's your financial summary.</p>


        </div>
    </div>

    <!-- Summary Bar -->
    <div class="row g-4 mb-5">

        <!-- Total Spent -->
        <div class="col-md-4">
            <div class="insight-tile">
                <div class="insight-icon spent">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="insight-content">
                    <p class="insight-label">Total Spent This Month</p>
                    <h3 class="insight-value">₹{{ total_this_month }}</h3>
                </div>
            </div>
        </div>

        <!-- Top Category -->
        <div class="col-md-4">
            <div class="insight-tile">
                <div class="insight-icon category">
                    <i class="fas fa-tags"></i>
                </div>
                <div class="insight-content">
                    <p class="insight-label">Top Category</p>
                    <h3 class="insight-value">
                        {{ top_category }}<br>
                        <span class="sub-value">₹{{ top_category_amount }}</span>
                    </h3>
                </div>
            </div>
        </div>

        <!-- Transactions -->
                    <div class="col-md-4">
              <div class="insight-tile">

                <!-- Icon -->
                <div class="insight-icon count">
                  <i class="fas fa-wallet"></i>
                </div>

                <!-- Content -->
                <div class="insight-content">
                  <p class="insight-label">Monthly Budget</p>

                  <!-- Budget numbers -->
                  <h3 class="insight-value mb-1">
                    ₹{{ "%.2f"|format(month_budget) }}
                  </h3>

                  <p class="sub-value mb-2">
                    Spent: ₹{{ "%.2f"|format(total_this_month) }}
                    <br>
                    Remaining:
                    <strong
                      class="{% if left < 0 %}text-danger{% else %}text-success{% endif %}">
                      ₹{{ "%.2f"|format(left) }}
                    </strong>
                  </p>


                    {% if month_budget > 0 %}

              {% set percent = (total_this_month / month_budget) * 100 %}
              {% if percent < 0 %}
                {% set percent = 0 %}
              {% elif percent > 100 %}
                {% set percent = 100 %}
              {% endif %}

              <div class="progress" style="height: 16px;">
                <div
                  class="progress-bar
                    {% if percent < 70 %}
                      bg-success
                    {% elif percent < 90 %}
                      bg-warning
                    {% else %}
                      bg-danger
                    {% endif %}"
                  role="progressbar"
                  style="width: {{ percent }}%;">

                  <!-- Percentage Text -->
                  <span class="fw-bold text-white small">
                    {{ percent|round(0) }}%
                  </span>

                </div>
              </div>

            {% else %}
              <p class="text-muted small mt-2">
                No budget set
              </p>
            {% endif %}


                </div>
              </div>
            </div>


    </div>



    {% if overspent and overspend_amount > 0 %}
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm insight-alert">
      <div class="card-body d-flex align-items-start gap-3">

        <!-- Icon -->
        <div class="insight-icon danger">
          <i class="fas fa-exclamation-triangle"></i>
        </div>

        <!-- Text -->
        <div>
          <p class="mb-1 fw-semibold">
            You overspent your budget by
            <span class="text-danger">
              ₹{{ "%.2f"|format(overspend_amount) }}
            </span>
            this month.
          </p>

          {% if overspend_category %}
          <p class="mb-0 text-muted small">
            <strong>{{ overspend_category }}</strong> was the biggest contributor,
            accounting for {{ overspend_percent|round(0) }}% of your spending.
          </p>
          {% endif %}
        </div>

      </div>
    </div>
  </div>
</div>
{% endif %}
<!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} py-2 small">
              {{ message }}
            </div>
          {% endfor %}
        {% endif %}
        {% endwith %}
    <div class="row justify-content-center g-4">

        <div class="col-lg-4">
            <div class="action-tile" data-bs-toggle="modal" href="#portfolioModal1">
                <div class="action-icon add">
                    <i class="fas fa-plus"></i>
                </div>
                <div class="action-content">
                    <h5>Add Expense</h5>
                    <p>Log a new transaction</p>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <a class="action-tile" href="{{url_for('view_trans')}}"  style="color: inherit; text-decoration: none;"
   onmouseover="this.style.color='inherit'"
   onmouseout="this.style.color='inherit'">
                <div class="action-icon view">
                    <i class="fas fa-list"></i>
                </div>
                <div class="action-content">
                    <h5>View All Transactions</h5>
                    <p>See your spending history</p>
                </div>
            </a>
        </div>


    </div>
    <div class="mb-4"></div>



    <!-- Quick Add Form & Recent Transactions Row -->
    <div class="row">
        <!-- Quick Add Form Column -->
        <div class="col-lg-4">
            <div class="col-lg">
                <a class="action-tile " href="{{url_for('add_budget')}}"   style="color: inherit; text-decoration: none;"
   onmouseover="this.style.color='inherit'"
   onmouseout="this.style.color='inherit'">
                    <div class="action-icon view">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="action-content">
                        <h5>Set Monthly Budget</h5>
                        <p>Define your spending limit</p>
                    </div>
                </a>
            </div>
            <br>


            <!--        start    -->
            <div class="col-lg">
                <div class="action-tile">
                    <div class="action-icon analyze">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="action-content">
                        <h5>Analysis</h5>
                        <p>Understand your spending</p>
                    </div>
                </div>
            </div>
            <!--            end-->

        </div>

        <!-- Recent Transactions Column -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5>Recent Transactions</h5>
                </div>
                <div class="card-body">
                    {% if expenses %}
                    <table class="table table-striped transactions-table">
                        <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th class="text-end">Amount</th>
                            <!--                            <th>Delete</th>-->
                            <!--                            <th>Edit</th>-->
                        </tr>
                        </thead>
                        <tbody>
                        {% for expense in expenses %}
                        <tr>
                            <td>{{ expense.date.strftime("%d-%m-%Y") }}</td>
                            <td>{{ expense.category }}</td>
                            <td>{{ expense.description or "-" }}</td>
                            <td class="text-end">₹{{ "%.2f"|format(expense.amount) }}</td>
                            <!--                            <td><a href="{{ url_for('delete_expense', expense_id=expense.id) }}" onclick="return confirm('Are you sure you want to delete this expense?');">Delete</a>-->
                            <!--</td>-->
                            <!--                            <td><a href="{{ url_for('edit_expense', expense_id=expense.id) }}">Edit</a></td>-->
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p>No transactions yet. Add your first expense!</p>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>
</div>


<!-- Portfolio item 1 modal popup-->
<div class="portfolio-modal modal fade" id="portfolioModal1" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="close-modal" data-bs-dismiss="modal"><img src="./static/assets/img/close-icon.svg"
                                                                  alt="Close modal"/></div>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="modal-body">
                            <!-- Project details-->
                            <!--                                    <h2 class="text-uppercase">Project Name</h2>-->
                            <!--                                    <p class="item-intro text-muted">Lorem ipsum dolor sit amet consectetur.</p>-->
                            <!--                                    <img class="img-fluid d-block mx-auto" src="./static/assets/img/portfolio/1.jpg" alt="..." />-->
                            <!--                                    <p>Use this area to describe your project. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Est blanditiis dolorem culpa incidunt minus dignissimos deserunt repellat aperiam quasi sunt officia expedita beatae cupiditate, maiores repudiandae, nostrum, reiciendis facere nemo!</p>-->
                            <!--                                    <ul class="list-inline">-->
                            <!--                                        <li>-->
                            <!--                                            <strong>Client:</strong>-->
                            <!--                                            Threads-->
                            <!--                                        </li>-->
                            <!--                                        <li>-->
                            <!--                                            <strong>Category:</strong>-->
                            <!--                                            Illustration-->
                            <!--                                        </li>-->
                            <!--                                    </ul>-->
                            <!--                                    <button class="btn btn-primary btn-xl text-uppercase" data-bs-dismiss="modal" type="button">-->
                            <!--                                        <i class="fas fa-xmark me-1"></i>-->
                            <!--                                        Close Project-->
                            <!--                                    </button>-->
                            <div class="col-lg ">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Add New Expense</h5>
                                    </div>
                                    <div class="card-body">
                                        <!--form is there for details -->
<!--                                        {{render_form(form, novalidate=True, button_map={"submit": "primary"}) }}-->
<form method="POST" action="{{ url_for('add_expense') }}">
    {{ form.hidden_tag() }}

    <div class="mb-3">
        {{ form.amount.label(class="form-label") }}
        {{ form.amount(class="form-control") }}
    </div>

    <div class="mb-3">
        {{ form.category.label(class="form-label") }}
        {{ form.category(class="form-select") }}
    </div>

    <div class="mb-3">
        {{ form.description.label(class="form-label") }}
        {{ form.description(class="form-control") }}
    </div>

    <div class="mb-3">
        {{ form.date.label(class="form-label") }}
        {{ form.date(class="form-control") }}
    </div>

    <button type="submit" class="btn btn-primary w-100">
        Add Expense
    </button>
</form>


                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% include "footer.html" %}